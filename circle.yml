machine:
  environment:
    DJANGO_SETTINGS_MODULE: vis.settings.heroku

general:
  branches:
    only:
    - master
    - develop

dependencies:
  post:
    - bower install

test:
  pre:
    - node_modules/.bin/gulp build:prod
    - python manage.py collectstatic --noinput

deployment:
  staging:
    branch: develop
    commands:
      - git push git@heroku.com:vis-staging.git $CIRCLE_SHA1:master -f
      - heroku run python manage.py migrate --noinput --app vis-staging
  production:
    branch: master
    commands:
      - git push git@heroku.com:vis-prod.git $CIRCLE_SHA1:master -f
      - heroku run python manage.py migrate --noinput --app vis-prod

